window.playerState=window.playerState||{};playerState.logFile='';playerState.attempts=0;playerState.videoTime=null;playerState.attemptsAllowed=10;playerState.playerName=null;playerState.firstVisit=null;playerState.isFirstVisit=function(){if(playerState.firstVisit===null){const vTurbLoaded=typeof window.vTurb==='undefined'||(typeof window.vTurb!=='undefined'&&!window.vTurb.alreadyElsDisplayed);const youtubeLoaded=typeof window.UPplayer==='undefined'||(typeof window.UPplayer!=='undefined'&&window.UPplayer.firstTimePlaying!==false);const cloudflareLoaded=typeof window.CF==='undefined'||(typeof window.CF!=='undefined'&&!window.CF.previousVisit);playerState.firstVisit=vTurbLoaded&&youtubeLoaded&&cloudflareLoaded;}
return playerState.firstVisit;};playerState.logToServer=(currentTime)=>{const logValue=currentTime?1:0;const path=`${playerState.logFile}?played=${logValue}`;navigator.sendBeacon(path);console.log(`${playerState.playerName} Video playing log to server: ${logValue}`);};playerState.getTime=function(){playerState.playerName=playerState.getPlayer();if(playerState.playerName===null)return;switch(playerState.playerName){case 'vTurb':playerState.videoTime=window.smartplayer.instances[0].video.currentTime;break;case 'YouTube':playerState.videoTime=window.UPplayer.currentTime;break;case 'Cloudflare':playerState.videoTime=window.CF.currentTime;break;default:break;}
return playerState.videoTime;};playerState.getPlayer=function(){if(window.vTurb&&window.vTurb.config&&window.smartplayer&&window.smartplayer.instances&&window.smartplayer.instances.length&&window.smartplayer.instances[0].video&&window.smartplayer.instances[0].video.currentTime){playerState.playerName='vTurb';}else if(window.UPplayer&&window.UPplayer.config&&window.UPplayer.currentTime){playerState.playerName='YouTube';}else if(window.CF&&window.CF.player&&window.CF.currentTime){playerState.playerName='Cloudflare';}
return playerState.playerName;};playerState.waitForPlayer=function(maxAttempts){playerState.attempts=0;return new Promise(function(resolve,reject){function checkPlayer(){playerState.playerName=playerState.getPlayer();if(typeof playerState.playerName!=='undefined'&&playerState.playerName!==null){resolve();}else{playerState.attempts++;if(playerState.attempts<=maxAttempts){setTimeout(checkPlayer,1000);}else{reject('Maximum number of attempts reached. Unable to retrieve Player');}}}
checkPlayer();});};playerState.evalActivePlayer=function(secondsUntilCheck=15,timeForASecondCheck=2,logFileURL){playerState.logFile=logFileURL;const isFirstVisit=playerState.isFirstVisit();if(!isFirstVisit)return;try{playerState.waitForPlayer(playerState.attemptsAllowed).then(function(){console.log('Player is loaded');playerState.evalPlayingState(secondsUntilCheck-playerState.attempts,timeForASecondCheck);}).catch(function(error){playerState.logToServer(0);console.log(error);});}catch(error){playerState.logToServer(0);console.log('Error:',error);}}
playerState.evalPlayingState=function(secondsUntilCheck,timeForASecondCheck){setTimeout(()=>{playerState.getTime();if(playerState.videoTime==0){setTimeout(()=>{playerState.getTime();playerState.logToServer(playerState.videoTime);},timeForASecondCheck);}else{playerState.logToServer(playerState.videoTime);}},secondsUntilCheck);}